<div class="row">
  <div class="col-lg-4 offset-1 py-5">
    <div class="mb-5"><%= attachment_image_tag @post, :image, class: "img-fluid rounded align-self-center", fallback: "no_image.jpg" %></div>
    <div id=map></div>
  </div>
    <div class="col-lg-5 offset-1 py-5">
      <div class="row">
        <div class="col-10">
          <table class="table">
            <tr>
              <td style="width: 30%" >名前</td>
              <td style="width: 70%"><%= link_to @post.user.name, user_path(@user) %></td>
            </tr>
            <tr></tr>
            <tr>
              <td style="width: 30%">大きさ</td>
              <td style="width: 70%"><%= @post.dog_size %></td>
            </tr>
            <tr>
              <td style="width: 30%">place名</td>
              <td style="width: 70%"><%= @post.place %></td>
            </tr>
            <tr>
              <td style="width: 30%">カテゴリー</td>
              <td style="width: 70%"><%= @post.category.name %></td>
            </tr>
            <tr>
              <td style="width: 30%">住所</td>
              <td style="width: 70%"><%= @post.address %></td>
            </tr>
            <tr>
              <td style="width: 30%">説明</td>
              <td style="width: 70%"><p class="text-break"> <%= @post.introduction %></td>
            </tr>
            <tr>
              <td style="width: 30%">投稿日時</td>
              <td style="width: 70%"><%= @post.created_at.strftime('%Y/%m/%d') %></td>
            </tr>
            
            <% if @user.id == current_user.id %>
              <tr>
                <td style="width: 40%"><%= link_to "投稿編集", edit_post_path(@post), class: "btn btn-success" %></td>
                <td style="width: 60%"><%= link_to "投稿削除", post_path(@post), method: :delete,class: "btn btn-danger", data: { confirm: "本当に投稿を削除しますか？" } %></td>
              </tr>  
            <% end %>
          </table>
        
          <table class="table table-borderless">
            <tr>
              <td>コメント件数：<%= @post.post_comments.count %></td>
            </tr>
            <% @post.post_comments.each do |post_comment| %>
              <tr>
                <td><%= post_comment.user.name %></td>
                <td><%= post_comment.comment %></td>
                <td><%= post_comment.created_at.strftime('%Y/%m/%d') %></td>
                <% if post_comment.user == current_user %>
                  <td>
                    <%= link_to "削除",  post_comment_path(post_comment), method: :delete %>
                  </div>
                <% end %>
              </tr>
            <% end %>  
          </table>

          <%= form_with(model:[@post, @post_comment], local: true) do |f| %>
            <div class="form-group">
                <%= f.text_area :comment, rows:'3',placeholder: "コメントをここに", class: "form-control" %>
            </div>
            <div class="form-group">
              <%= f.submit "コメントする", class: "btn btn-info btn-sm" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
</div>

<script>
function initMap(){
  let geocoder = new google.maps.Geocoder()
  let map = new google.maps.Map(document.getElementById('map'), {
  center: {lat: -34.397, lng: 150.644},
  zoom: 15
  });
  let address = '<%= @post.address %>';
  geocoder.geocode( { 'address': address }, function(results, status) {
    if (status == 'OK') {
      map.setCenter(results[0].geometry.location);
      var marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location
      });
    } else {
      alert('該当する結果がありませんでした：' + status);
    }
  });
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['G_KEY'] %>&callback=initMap" async defer></script>